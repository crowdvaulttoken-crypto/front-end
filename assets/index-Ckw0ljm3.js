import{a as s,j as e,f as i,p as D}from"./index-BEF_KIxg.js";import{P as E}from"./Page-BXjP-X0h.js";import{u as B}from"./useSmartContract-BwA5v_mV.js";function F(){const{address:r,CrowdVaultContract:l}=B(),[a,p]=s.useState(null),[u,v]=s.useState([]),[A,w]=s.useState(!0),[L,N]=s.useState(""),[P,S]=s.useState(""),[o,x]=s.useState(1),[m,c]=s.useState(!1);return s.useEffect(()=>{let t=!0;return m||(async()=>{if(!r||!l)return;const d=a||r;try{if(!t)return;const f=await l.getChildren(!0,d,0,100),y=await Promise.all(f.map(async g=>{const[T,k,j]=await l.getAffiliateData(g);return{address:g,level:parseInt(j)<1?0:parseInt(j)-1,parent:T,agent:k}})),n=await l.getAffiliateData(d),C=Array.isArray(y)?y:[],I=Array.isArray(n)?n[0]:d,b=Array.isArray(n)?parseInt(n[2])<1?0:parseInt(n[2])-1:0;v(C),N(I),S(b)}catch(f){t&&console.error("Failed to fetch affiliate data:",f)}finally{t&&(w(!1),c(!0))}})(),()=>{t=!1}},[l,r,a,m]),e.jsx(E,{title:"Network Tree",children:e.jsxs("div",{className:"max-w-xs p-10",children:[e.jsxs(i,{color:"primary",children:["Level ",o]}),e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2",children:e.jsxs("div",{className:"btn btn-primary w-100 mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(i,{color:"error",className:"rounded-full me-1",onClick:()=>{r!=a&&a!=null&&o>1&&(p(L),x(o-1),c(!1))},children:P}),e.jsx(i,{children:a||r})]})}),A?e.jsx("p",{children:"Loading..."}):u.length===0?e.jsx("p",{children:"No direct found."}):e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2 w-100",children:u.map((t,h)=>e.jsxs("div",{className:"d-flex flex-column mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(i,{color:t.address==t.broker?"info":"primary",className:"me-1",onClick:()=>{a!=t.address&&(p(t.address),x(o+1),c(!1))},children:parseInt(t.level)}),e.jsx(i,{children:t.address})]},h))})]})})}F.propTypes={tree:D.PropTypes.array};export{F as default};
