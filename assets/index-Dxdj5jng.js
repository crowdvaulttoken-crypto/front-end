import{a as r,j as e,h as l,p as k}from"./index-DWLpXC0w.js";import{P as D}from"./Page-DRL4ffSr.js";import{u as E}from"./useSmartContract-BXHuxxHU.js";function B(){const{address:s,CrowdVaultContract:n}=E(),[a,p]=r.useState(null),[u,w]=r.useState([]),[c,d]=r.useState(!0),[L,N]=r.useState(""),[A,P]=r.useState(""),[o,x]=r.useState(1);return r.useEffect(()=>{let t=!0;return(async()=>{if(!s||!n||!c)return;const h=a||s;try{if(!t)return;const f=await n.getChildren(!0,h,0,100),g=await Promise.all(f.map(async j=>{const[b,T,y]=await n.getAffiliateData(j);return{address:j,level:parseInt(y)>0?parseInt(y)-1:0,parent:b,agent:T}})),[C,,i]=await n.getAffiliateData(h),I=Array.isArray(g)?g:[],v=C,S=parseInt(i)>0&&parseInt(i)<=8?parseInt(i)-1:parseInt(i)>=9?8:0;w(I),N(v),P(S),console.log(v)}catch(f){t&&console.error("Failed to fetch affiliate data:",f)}finally{t&&d(!1)}})(),()=>{t=!1}},[n,s,a,c]),e.jsx(D,{title:"Network Tree",children:e.jsxs("div",{className:"max-w-xs p-10",children:[e.jsxs(l,{color:"primary",children:["Level ",o]}),e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2",children:e.jsxs("div",{className:"btn btn-primary w-100 mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(l,{color:"error",className:"rounded-full me-1",onClick:()=>{s!=a&&a!=null&&o>1&&(p(L),x(o-1),d(!0))},children:A}),e.jsx(l,{children:a||s})]})}),c?e.jsx("p",{children:"Loading..."}):u.length===0?e.jsx("p",{children:"No direct found."}):e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2 w-100",children:u.map((t,m)=>e.jsxs("div",{className:"d-flex flex-column mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(l,{color:t.address==t.broker?"info":"primary",className:"me-1",onClick:()=>{a!=t.address&&(p(t.address),x(o+1),d(!0))},children:parseInt(t.level)}),e.jsx(l,{children:t.address})]},m))})]})})}B.propTypes={tree:k.PropTypes.array};export{B as default};
