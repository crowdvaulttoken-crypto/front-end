import{a as s,j as e,f as n,p as E}from"./index-B6VG0hLA.js";import{P as B}from"./Page-CQkXL6xy.js";import{u as F}from"./useSmartContract-C-QDBB2P.js";function H(){const{address:r,CrowdVaultContract:l}=F(),[a,p]=s.useState(null),[u,v]=s.useState([]),[A,w]=s.useState(!0),[L,N]=s.useState(""),[P,S]=s.useState(""),[i,x]=s.useState(1),[m,c]=s.useState(!1);return s.useEffect(()=>{let t=!0;return m||(async()=>{if(!r||!l)return;const d=a||r;try{if(!t)return;const f=await l.getChildren(!0,d,0,100),g=await Promise.all(f.map(async j=>{const[T,k,D]=await l.getAffiliateData(j);return{address:j,level:D,parent:T,agent:k}})),o=await l.getAffiliateData(d),C=Array.isArray(g)?g:[],y=Array.isArray(o)?o[0]:d,b=Array.isArray(o)?o[2]:0;v(C),N(y),S(b),console.log(y)}catch(f){t&&console.error("Failed to fetch affiliate data:",f)}finally{t&&w(!1)}c(!0)})(),()=>{t=!1}},[l,r,a,m]),e.jsx(B,{title:"Network Tree",children:e.jsxs("div",{className:"max-w-xs p-10",children:[e.jsxs(n,{color:"primary",children:["Level ",i]}),e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2",children:e.jsxs("div",{className:"btn btn-primary w-100 mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(n,{color:"error",className:"rounded-full me-1",onClick:()=>{r!=a&&a!=null&&i>1&&(p(L),x(i-1),c(!1))},children:P}),e.jsx(n,{children:a||r})]})}),A?e.jsx("p",{children:"Loading..."}):u.length===0?e.jsx("p",{children:"No direct found."}):e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2 w-100",children:u.map((t,h)=>e.jsxs("div",{className:"d-flex flex-column mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(n,{color:t.address==t.broker?"info":"primary",className:"me-1",onClick:()=>{a!=t.address&&(p(t.address),x(i+1),c(!1))},children:t.level}),e.jsx(n,{children:t.address})]},h))})]})})}H.propTypes={tree:E.PropTypes.array};export{H as default};
