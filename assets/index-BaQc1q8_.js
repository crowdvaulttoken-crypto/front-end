import{a as r,j as e,h as l,p as k}from"./index-OGkhHXGX.js";import{P as D}from"./Page-DD8Ph8cN.js";import{u as E}from"./useSmartContract-C4OxqyCw.js";function B(){const{address:s,CrowdVaultContract:n}=E(),[a,p]=r.useState(null),[u,j]=r.useState([]),[d,f]=r.useState(!0),[y,w]=r.useState(""),[L,N]=r.useState(""),[i,x]=r.useState(1);return r.useEffect(()=>{if(!s||!n||!d)return;let t=!0;return(async()=>{try{const o=a||s;if(!t)return;const A=await n.getChildren(!0,o,0,100),h=await Promise.all(A.map(async g=>{const[b,T,v]=await n.getAffiliateData(g);return{address:g,level:parseInt(v)>0?parseInt(v)-1:0,parent:b,agent:T}})),[P,,c]=await n.getAffiliateData(o),C=Array.isArray(h)?h:[],I=P,S=parseInt(c)>0&&parseInt(c)<=8?parseInt(c)-1:parseInt(c)>=9?8:0;j(C),w(I),N(S)}catch(o){t&&console.error("Failed to fetch affiliate data:",o)}finally{t&&f(!1)}})(),()=>{t=!1}},[n,s,a,d]),e.jsx(D,{title:"Network Tree",children:e.jsxs("div",{className:"max-w-xs p-10",children:[e.jsxs(l,{color:"primary",children:["Level ",i]}),e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2",children:e.jsxs("div",{className:"btn btn-primary w-100 mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(l,{color:"error",className:"rounded-full me-1",onClick:()=>{s!=a&&a!=null&&i>1&&(p(y),x(i-1),f(!0))},children:L}),e.jsx(l,{children:a||s})]})}),d?e.jsx("p",{children:"Loading..."}):u.length===0?e.jsx("p",{children:"No direct found."}):e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2 w-100",children:u.map((t,m)=>e.jsxs("div",{className:"d-flex flex-column mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(l,{color:t.address==t.broker?"info":"primary",className:"me-1",onClick:()=>{a!=t.address&&(p(t.address),x(i+1),f(!0))},children:parseInt(t.level)}),e.jsx(l,{children:t.address})]},m))})]})})}B.propTypes={tree:k.PropTypes.array};export{B as default};
