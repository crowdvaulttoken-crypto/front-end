import{a as r,j as e,h as n,p as k}from"./index-BnweCsDO.js";import{P as D}from"./Page-C48s_Nin.js";import{u as E}from"./useSmartContract-DqLYIZVa.js";function B(){const{address:s,CrowdVaultContract:l}=E(),[a,f]=r.useState(null),[p,w]=r.useState([]),[i,c]=r.useState(!0),[L,N]=r.useState(""),[A,P]=r.useState(""),[o,u]=r.useState(1);return r.useEffect(()=>{let t=!0;return(async()=>{if(!s||!l||!i)return;const m=a||s;try{if(!t)return;const d=await l.getChildren(!0,m,0,100),h=await Promise.all(d.map(async j=>{const[I,T,y]=await l.getAffiliateData(j);return{address:j,level:parseInt(y)>0?parseInt(y)-1:0,parent:I,agent:T}})),[C,,g]=await l.getAffiliateData(m),S=Array.isArray(h)?h:[],v=C,b=parseInt(g)>0?parseInt(g)-1:0;w(S),N(v),P(b),console.log(v)}catch(d){t&&console.error("Failed to fetch affiliate data:",d)}finally{t&&c(!1)}})(),()=>{t=!1}},[l,s,a,i]),e.jsx(D,{title:"Network Tree",children:e.jsxs("div",{className:"max-w-xs p-10",children:[e.jsxs(n,{color:"primary",children:["Level ",o]}),e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2",children:e.jsxs("div",{className:"btn btn-primary w-100 mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(n,{color:"error",className:"rounded-full me-1",onClick:()=>{s!=a&&a!=null&&o>1&&(f(L),u(o-1),c(!0))},children:A}),e.jsx(n,{children:a||s})]})}),i?e.jsx("p",{children:"Loading..."}):p.length===0?e.jsx("p",{children:"No direct found."}):e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2 w-100",children:p.map((t,x)=>e.jsxs("div",{className:"d-flex flex-column mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(n,{color:t.address==t.broker?"info":"primary",className:"me-1",onClick:()=>{a!=t.address&&(f(t.address),u(o+1),c(!0))},children:parseInt(t.level)}),e.jsx(n,{children:t.address})]},x))})]})})}B.propTypes={tree:k.PropTypes.array};export{B as default};
