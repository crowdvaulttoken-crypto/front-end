import{a as s,j as e,h as i,p as D}from"./index-BPlWD8VV.js";import{P as E}from"./Page-BN16MiwB.js";import{u as B}from"./useSmartContract-CNefsSHn.js";function F(){const{address:r,CrowdVaultContract:l}=B(),[a,p]=s.useState(null),[u,j]=s.useState([]),[v,A]=s.useState(!0),[w,L]=s.useState(""),[N,P]=s.useState(""),[o,x]=s.useState(1),[m,c]=s.useState(!1);return s.useEffect(()=>{let t=!0;return m||(async()=>{if(!r||!l)return;const d=a||r;try{if(!t)return;const f=await l.getChildren(!0,d,0,100),y=await Promise.all(f.map(async g=>{const[I,T,k]=await l.getAffiliateData(g);return{address:g,level:parseInt(k),parent:I,agent:T}})),n=await l.getAffiliateData(d),S=Array.isArray(y)?y:[],C=Array.isArray(n)?n[0]:d,b=Array.isArray(n)?parseInt(n[2])<1?0:parseInt(n[2])-1:0;j(S),L(C),P(b)}catch(f){t&&console.error("Failed to fetch affiliate data:",f)}finally{t&&(A(!1),c(!0))}})(),()=>{t=!1}},[l,r,a,m]),e.jsx(E,{title:"Network Tree",children:e.jsxs("div",{className:"max-w-xs p-10",children:[e.jsxs(i,{color:"primary",children:["Level ",o]}),e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2",children:e.jsxs("div",{className:"btn btn-primary w-100 mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(i,{color:"error",className:"rounded-full me-1",onClick:()=>{r!=a&&a!=null&&o>1&&(p(w),x(o-1),c(!1))},children:N}),e.jsx(i,{children:a||r})]})}),v?e.jsx("p",{children:"Loading..."}):u.length===0?e.jsx("p",{children:"No direct found."}):e.jsx("div",{className:"d-flex flex-column flex-row-fluid gap-2 m-2 w-100",children:u.map((t,h)=>e.jsxs("div",{className:"d-flex flex-column mb-3",style:{textAlign:"left",padding:"0px"},children:[e.jsx(i,{color:t.address==t.broker?"info":"primary",className:"me-1",onClick:()=>{a!=t.address&&(p(t.address),x(o+1),c(!1))},children:parseInt(t.level)}),e.jsx(i,{children:t.address})]},h))})]})})}F.propTypes={tree:D.PropTypes.array};export{F as default};
