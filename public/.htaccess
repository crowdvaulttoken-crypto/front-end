# Force HTTPS for all traffic
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirect from WWW to non-WWW
RewriteEngine On
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Exclude /shop and /wp (WordPress) from React routing
RewriteCond %{REQUEST_URI} ^/(auth|api|react)
RewriteRule ^ - [L]

# Serve root index.html
RewriteCond %{REQUEST_URI} ^/$
RewriteRule ^$ /index.html [L]

# Rewrite /assets/* to /react/dist/images/*
RewriteCond %{REQUEST_URI} ^/images/
RewriteRule ^images/(.*)$ /images/$1 [L]

# Rewrite /assets/* to /react/dist/assets/*
RewriteCond %{REQUEST_URI} ^/assets/
RewriteRule ^assets/(.*)$ /assets/$1 [L]

<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
RewriteBase /
RewriteRule ^index\.html$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ /index.html [L]
</IfModule>
